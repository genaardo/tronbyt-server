{{ define "app_list_grid" }}
<div class="app-group">
    <h3 class="margin-right-sm" style="display: inline-block;">{{ .Title }}</h3>
    {{ if and .ShowVersion .SystemRepoInfo .SystemRepoInfo.CommitHash }}
    <span class="text-sm text-muted">
        (version: <a href="{{ .SystemRepoInfo.CommitURL }}"
    target="_blank"
    class="text-primary"
    style="text-decoration: none"
    title="{{ .SystemRepoInfo.CommitHash }}">
    {{ if .SystemRepoInfo.CommitMessage }}{{ .SystemRepoInfo.CommitMessage }}{{ else }}{{ substr .SystemRepoInfo.CommitHash 0 8 }}{{ end }}
    </a>{{ if .SystemRepoInfo.CommitDate }} - {{ .SystemRepoInfo.CommitDate }}{{ end }})
</span>
{{ end }}
{{ if .ShowControls }}
<!-- Filter and Sort Controls -->
<div class="filter-sort-controls card">
    <div class="filter-sort-controls-inner">
        <input type="search"
               id="{{ .SearchID }}"
               placeholder="{{ t .Localizer "Search apps" }}"
               onkeyup="searchApps('{{ .SearchID }}', '{{ .GridID }}')"
               oninput="searchApps('{{ .SearchID }}', '{{ .GridID }}')"
               onkeydown="preventSubmitOnEnter(event)"
               style="padding: 8px; border: 1px solid var(--border-color); border-radius: 4px;" />
        <label class="control-label text-sm text-muted">
            <input type="checkbox"
                   id="hide_installed_{{ .SearchID }}"
                   onchange="toggleInstalledApps('{{ .SearchID }}')"
                   class="control-checkbox margin-right-xs">
            {{ t .Localizer "Hide installed apps" }}
        </label>
        <label class="control-label text-sm text-muted">
            <input type="checkbox"
                   id="show_broken_{{ .SearchID }}"
                   onchange="toggleBrokenApps('{{ .SearchID }}')"
                   class="control-checkbox margin-right-xs">
            {{ t .Localizer "Show broken apps" }}
        </label>
        <label for="sort_{{ .SearchID }}" class="control-label text-sm text-muted">
            {{ t .Localizer "Sort by:" }}
            <select id="sort_{{ .SearchID }}" onchange="sortApps('{{ .SearchID }}')" style="margin-left: 5px; padding: 4px; border: 1px solid var(--border-color); border-radius: 4px;">
                <option value="system" selected>{{ t .Localizer "Default" }}</option>
                <option value="newest">{{ t .Localizer "Newest" }}</option>
                <option value="alphabetical">{{ t .Localizer "Alphabetical (A-Z)" }}</option>
                <option value="rev-alphabetical">{{ t .Localizer "Alphabetical (Z-A)" }}</option>
            </select>
        </label>
    </div>
</div>
{{ end }}
<div id="{{ .GridID }}" class="app-grid">
    {{ range .Apps }}
    {{ template "app_card_grid_item" (dict "App" . "DeviceID" $.DeviceID "Localizer" $.Localizer "IsCustom" $.IsCustom "ConfigProduction" $.ConfigProduction) }}
    {{ end }}
</div>
</div>
{{ end }}
{{ define "app_card_grid_item" }}
<div class="app-item card {{ if .App.Broken }}broken-app{{ end }}"
     data-value="{{ .App.ID }}"
     data-path="{{ .App.Path }}"
     data-name="{{ .App.Name }}"
     data-installed="{{ .App.IsInstalled }}"
     data-recommended-interval="{{ .App.RecommendedInterval }}"
     data-date="{{ .App.Date }}"
     data-broken="{{ .App.Broken }}"
     data-author="{{ .App.Author }}"
     style="padding: 10px; position: relative;">
    {{ if .App.IsInstalled }}
    <div class="installed-badge badge badge-success">{{ t .Localizer "Installed" }}</div>
    {{ end }}
    {{ if .App.Supports2x }}
    <div class="supports-2x-badge badge badge-neutral">2x</div>
    {{ end }}
    <!-- Skeleton loader for images -->
    <div class="app-img">
        <div class="skeleton-loader"></div>
        <img data-src="/preview/app/{{ .App.ID }}"
             alt="{{ .App.Name }}"
             class="lazy-image"
             width="64"
             height="32"
             {{ if .App.Broken }}
             style="opacity: 0.4"
             {{ end }}>
    </div>
    <p class="text-main font-bold text-sm" {{ if .App.Broken }}style="opacity: 0.5;"{{ end }}>{{ .App.Name }}
        <span class="text-xs text-muted font-normal block">{{ .App.Summary }}</span>
    </p>
    {{ if .App.Author }}
    <p class="text-xs text-muted" {{ if .App.Broken }}style="opacity: 0.5;"{{ end }}>{{ t .Localizer "From" }} {{ .App.Author }}
    </p>
    {{ end }}
    {{ if .App.Broken }}
    <div class="badge badge-danger block-badge" style="width: 100%; margin-top: 5px;">
        <span class="material-symbols-outlined icon-text" style="font-size: 16px;">error</span> {{ t .Localizer "BROKEN" }}
        <br>
        <span style="font-size: 10px; font-weight: normal;">{{ .App.BrokenReason }}</span>
    </div>
    {{ end }}
    {{ if .IsCustom }}
    <a href="/devices/{{ .DeviceID }}/uploads/{{ .App.ID }}/delete"
       class="btn btn-danger btn-sm delete-upload-btn"
       onclick="event.stopPropagation(); return confirm('{{ t .Localizer "Delete this uploaded app?" }}');"
       style="width: 100%; box-sizing: border-box;">
        <span class="material-symbols-outlined icon-text">delete</span> {{ t .Localizer "Delete" }}
    </a>
    {{ end }}
    {{ if eq .ConfigProduction "0" }}
    {{ if .App.Broken }}
    <button class="btn btn-success btn-sm unmark-broken-btn"
            onclick="unmarkAppAsBroken('{{ .App.FileName }}', '{{ .App.PackageName }}', event, {{ t .Localizer "UnmarkAppBrokenConfirm" (dict "AppName" .App.FileName) | json }});"
            style="width: 100%; margin-top: 5px;">{{ t .Localizer "Unmark Broken" }}</button>
{{ else }}
    <button class="btn btn-danger btn-sm mark-broken-btn"
            onclick="markAppAsBroken('{{ .App.FileName }}', '{{ .App.PackageName }}', event, {{ t .Localizer "MarkAppBrokenConfirm" (dict "AppName" .App.FileName) | json }});"
            style="width: 100%; margin-top: 5px;">{{ t .Localizer "Mark Broken" }}</button>
    {{ end }}
    {{ end }}
</div>
{{ end }}
